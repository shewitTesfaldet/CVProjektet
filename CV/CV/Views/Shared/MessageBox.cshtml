@model List<Chat>

<div id="frame">
    <div id="sidepanel">
        <div id="profile">
            <div class="wrap">
                <img id="profile-img" src="http://emilcarlsson.se/assets/mikeross.png" class="online" alt="" />
                <AuthorizeView>
                    <Authorized>
                        <p>@User.Identity.Name</p>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>

        <form asp-action="MessageBox" method="get">

            <div id="search">

                <label for=""><i class="fa fa-search" aria-hidden="true"></i></label>
                <input type="text" name="message" placeholder="Search contacts..." />
                <button class="submit" type="submit" value="submit"><i class="fa fa-paper-plane" aria-hidden="true">Sök</i></button>

            </div>

            @if (ViewBag.users != null)
            {
                <div id="contacts">
                    <ul>
                        @foreach (User user in ViewBag.users)
                        {
                            <li class="contact">
                                <button asp-route-UID="user.UID" name="clickID" type="submit" style="width: 100%; height: 100%; border: none; background: none;">

                                    <div class="wrap">
                                        <span class="contact-status online"></span>
                                        <img src="http://emilcarlsson.se/assets/louislitt.png" alt="Bild på inloggad" /> @*Lägg till koppling till bild via viewbag. måste kopplas med user-cv*@
                                        <div class="meta">
                                            <p class="name">@user.Firstname @user.Lastname</p>
                                            <p class="name">@user.Username</p>
                                        </div>
                                    </div>
                                </button>
                                <input type="hidden" name="getLogedOnUser" value="@User.Identity.Name" />
                            </li>
                        }
                    </ul>
                </div>
            }
            </form>

    </div>
    <div class="content">
        <div class="contact-profile">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>@ViewBag.ClickedName</p>
        </div>

        <div class="messages">
            <ul>
                @if (Model != null)
                {
                    @foreach (Chat chat in Model)
                    {
                        if (chat.SenderID.Equals(ViewBag.LoggedInID))
                        {
                            <li class="sent">
                                <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
                                <p>@chat.Text</p>
                            </li>
                            <p style="font-size:0.5em;">@chat.Date</p>

                        }
                        else
                        {
                            <li class="replies">
                                <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
                                <p>@chat.Text</p>
                            </li>
                            <p style="font-size:0.5em; margin-left:55em;">@chat.Date</p>

                        }
                    }
                }

            </ul>
        </div>

        <form asp-controller="Chat" asp-action="MessageBox" method="post">
            <div class="message-input">
                <div class="wrap">
                    <input type="hidden" name="UID" value="@ViewBag.ClickedID" />
                    <input type="text" name="med" placeholder="Skicka ett meddelande..." style="margin-left:1em;" />
                    <button class="submit" type="submit" value="Skicka"><i class="fa fa-paper-plane" aria-hidden="true">Skicka</i></button>
                </div>
            </div>
        </form>

    </div>

    <script src='//production-assets.codepen.io/assets/common/stopExecutionOnTimeout-b2a7b3fe212eaa732349046d8416e00a9dec26eb7fd347590fbced3ab38af52e.js'></script><script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
    <script>

        $(".messages").animate({ scrollTop: $(document).height() }, "fast");


        $(".expand-button").click(function () {
            $("#profile").toggleClass("expanded");
            $("#contacts").toggleClass("expanded");
        });

        //Med hjälp av ajax uppdatteras sidan när man trycker submit
        $.ajax({
            url: '/Chat/MessageBox',
            type: 'POST',
            data: { 'med': message },
            success: function (data) {
                // Uppdatera vyn med det nya meddelandet
                $('.messages ul').append('<li class="sent"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + message + '</p></li>');
            }
        });

        // function newMessage() {
        //     message = $(".message-input input").val();
        //     if ($.trim(message) == '') {
        //         return false;
        //     }
        //     $('<li class="sent"><img src="http://emilcarlsson.se/assets/mikeross.png" alt="" /><p>' + message + '</p></li>').appendTo($('.messages ul'));
        //     $('.message-input input').val(null);
        //     $('.contact.active .preview').html('<span>You: </span>' + message);
        //     $(".messages").animate({ scrollTop: $(document).height() }, "fast");
        // };

        // $('.submit').click(function () {
        //     newMessage();
        // });

        // $(window).on('keydown', function (e) {
        //     if (e.which == 13) {
        //         newMessage();
        //         return false;
        //     }
        // });
    </script>

